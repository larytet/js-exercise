<!DOCTYPE HTML>
<html><body>

<script>
var ports = [12381, 12382, 12383];
</script>

<script>



class XMLHttpAsyncRequest {
  constructor(url, timeout) {
    var xhr = new XMLHttpRequest();
  	xhr.open('GET', url, true);
    xhr._requestUrl = url;
    xhr._result = XMLHttpAsyncRequest.Result.unknown;
    xhr.timeout = timeout;
  	xhr.onload = this.onload
  	xhr.ontimeout = this.ontimeout
  	xhr.onerror = this.onerror
  	this._xhr = xhr;
    xhr.send(null);
    console.log("Send GET: "+url);
  }
  static get Result() {
    return {"unknown": 0, "error": 1, "timeout": 2, "ok": 3};
  }
  getUrl() {
    return this._xhr._requestUrl;
  }
  isError() {
    return (this._xhr._result == XMLHttpAsyncRequest.Result.error);
  }
  onload() {
    this._result = XMLHttpAsyncRequest.Result.ok;
    console.log("Onload: "+this.response);
  }
  ontimeout(e) {
    this._result = XMLHttpAsyncRequest.Result.timeout;
    console.log("Ontimeout: status="+this.statusText+" total="+e.total+" lengthComputable="+e.lengthComputable);
  }
  onerror(e) {
    this._result = XMLHttpAsyncRequest.Result.error;
    console.log("Onerror: url="+this._requestUrl);
  }
}

function createUrl(port) {
  return "https://127.0.0.1:"+port+"/index.html"
}

var requestTimeout = 500;
requests = []
ports.forEach(function(port) {
  var url = createUrl(port)
  requests.push(new XMLHttpAsyncRequest(url, requestTimeout));
});

function printStatus()
{
  requests.forEach(function(request) {
    url = request.getUrl();
    if (request.isError()) {
      console.log("Request "+url+" failed");
    }
  });
}

setTimeout(printStatus, requestTimeout+500)

</script>

</body></html>




